<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>曉・旅遊雲端實錄</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Inter:wght@900&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #F2F2F2; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        /* 曉組織硬派視覺：粗黑框 + 硬陰影 */
        .neo-brutalism { border: 4px solid #000; box-shadow: 8px 8px 0px #000; transition: all 0.1s; cursor: pointer; }
        .neo-brutalism:active { transform: translate(4px, 4px); box-shadow: 0px 0px 0px #000; }
        .akatsuki-red { color: #D32F2F; }
        .akatsuki-bg-red { background-color: #D32F2F; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body x-data="app()" x-init="fetchSchedule()">

    <header class="p-6 pt-12">
        <p class="text-xs font-black tracking-widest text-gray-500 italic">OFFICIAL ORGANIZATION APP</p>
        <h1 class="text-4xl font-black italic tracking-tighter uppercase">Akatsuki <span class="akatsuki-red">Cloud</span></h1>
    </header>

    <main class="p-4 pb-40">
        
        <template x-if="tab === 'home'">
            <div class="grid grid-cols-2 gap-4">
                <div @click="tab = 'schedule'" class="col-span-2 p-8 bg-white neo-brutalism relative overflow-hidden">
                    <h2 class="text-4xl font-black leading-none">旅程<br>時間軸</h2>
                    <p class="font-bold akatsuki-red mt-4 underline decoration-4">SYNCED FROM SHEETS →</p>
                </div>
                
                <div @click="tab = 'budget'" class="p-6 bg-white neo-brutalism flex flex-col justify-between aspect-square">
                    <span class="text-4xl font-black">¥</span>
                    <span class="font-black text-xl">人民幣記帳</span>
                </div>
                
                <div class="p-6 bg-black text-white neo-brutalism flex flex-col justify-center">
                    <div class="space-y-2">
                        <div class="h-1 w-full bg-red-600"></div>
                        <div class="h-1 w-1/2 bg-red-600"></div>
                    </div>
                    <span class="mt-4 font-black italic text-[10px] akatsuki-red">DATA SECURED</span>
                </div>
            </div>
        </template>

        <template x-if="tab === 'budget'">
            <div class="space-y-6">
                <div class="p-8 bg-black text-white neo-brutalism">
                    <div class="text-xs akatsuki-red font-black uppercase">Input CNY</div>
                    <div class="text-6xl font-black text-right mt-2 truncate" x-text="cnyInput || '0'"></div>
                    <div class="mt-6 pt-4 border-t border-gray-800 flex justify-between items-center">
                        <span class="text-gray-500 font-bold italic">Rate 1 : 4.5</span>
                        <span class="text-2xl akatsuki-red font-black">≈ NT$ <span x-text="Math.round(cnyInput * 4.5)"></span></span>
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <template x-for="n in ['1','2','3','4','5','6','7','8','9','C','0','SAVE']">
                        <button @click="handleInput(n)" 
                                class="p-6 bg-white neo-brutalism font-black text-2xl h-20 flex items-center justify-center"
                                :class="n === 'SAVE' ? 'akatsuki-bg-red text-white' : ''"
                                x-text="n">
                        </button>
                    </template>
                </div>
            </div>
        </template>

        <template x-if="tab === 'schedule'">
            <div class="space-y-4">
                <button @click="fetchSchedule()" class="w-full py-2 bg-gray-200 font-black text-[10px] tracking-widest neo-brutalism mb-4">RELOAD DATA ↻</button>
                <div class="border-l-8 border-black ml-2 pl-6 space-y-6">
                    <template x-for="item in scheduleData">
                        <div class="p-4 bg-white neo-brutalism">
                            <p class="text-xs font-black akatsuki-red" x-text="item.Time"></p>
                            <h3 class="text-xl font-black" x-text="item.Activity"></h3>
                            <p class="text-xs text-gray-400 font-bold" x-text="item.Date"></p>
                        </div>
                    </template>
                </div>
            </div>
        </template>
    </main>

    <footer class="fixed bottom-0 w-full p-6 bg-[#F2F2F2]/90 backdrop-blur-sm flex justify-center">
        <button @click="tab = 'home'" class="w-full max-w-md py-4 akatsuki-bg-red text-white neo-brutalism font-black text-xl tracking-[0.3em]">
            HOME / MENU
        </button>
    </footer>

    <script>
        function app() {
            // ⚠️ 請在此處填入你部署好的網頁應用程式網址
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw0vp6q2cJY-N9WbG9svQEp-JYlZIZK94ic1BAPUcMx_6eZ24jfjZBsgkcYU_WIJ1Fwnw/exec"; 

            return {
                tab: 'home',
                cnyInput: '',
                scheduleData: [],
                async fetchSchedule() {
                    try {
                        const res = await fetch(SCRIPT_URL);
                        this.scheduleData = await res.json();
                    } catch (e) {
                        console.error("讀取行程失敗", e);
                    }
                },
                async handleInput(n) {
                    if (n === 'C') {
                        this.cnyInput = '';
                    } else if (n === 'SAVE') {
                        if (!this.cnyInput) return;
                        const payload = {
                            cny: this.cnyInput,
                            twd: Math.round(this.cnyInput * 4.5),
                            payer: "旅伴"
                        };
                        // 傳送到 Google Sheets
                        await fetch(SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors', // 解決跨域問題
                            body: JSON.stringify(payload)
                        });
                        alert('已記錄至雲端！');
                        this.cnyInput = '';
                    } else {
                        if (this.cnyInput.length < 8) this.cnyInput += n;
                    }
                }
            }
        }
    </script>
</body>
</html>